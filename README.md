# Проектная работа "Веб-ларек"
[___](https://github.com/dub4ex/web-larek-frontend.git)
Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```



# ДОКУМЕНТАЦИЯ

## Данные и типы данных, используемые в приложении

Товар получаемый с сервера

```ts
interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: TCategory;
  price: number
}
```

Категория товара

```ts
enum TCategory {
  soft = 'софт-скил',
  hard = 'хард-скил',
  button = 'кнопка',
  additional = 'дополнительное',
  other = 'другое'
}
```

Интерфейс для модели данных

```ts
interface IAppState {
  catalog: IProduct[];
  preview: IProduct | null;
  basket: IProduct[];
  order: IOrder | null
}
```

Интерфейс формы выбора оплаты и адреса

```ts
interface IOrderForm {
  address: string;
  payment: TPayment | string
}
```

Тип выбора оплаты

```ts
type TPayment = 'card' | 'cash'
```

Данные оплаты и адреса используемые в форме

```ts
type TFormOrderErrors = Partial<Record<keyof IOrderForm, string>>
```

Интерфейс формы контактных данных

```ts
interface IContactsForm {
  email: string;
  phone: string;
}
```

Контактные данные используемые в форме

```ts
type TFormContactsErrors = Partial<Record<keyof IContactsForm, string>>
```

Интерфейс объекта заказа который отправляется на сервер

```ts
interface IOrder {
  payment: string;
  address: string;
  email: string;
  phone: string;
  total: number;
  items: string[]
}
```

Интерфейс объекта полученный в ответ после отправки заказа

```ts
interface IOrderResponse {
  id: string;
  total: number
}
```

Интерфейс запросов API

```ts
interface IAppAPI {
  getProductList: () => Promise<IProduct[]>;
  postFinalOrder: (item: IOrder) => Promise<IOrderResponse>
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

-слой представления отвечает за отображение данных на странице
-слой данных отвечает за хранение и изменения данных
-презентер отвечает за связь представления и данных


### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передаётся базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса и отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позовляет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
-`on` - Подписка на событие
-`emit` - инициализация события
-`trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс AppState
Класс отвечает за хранения данных и служит для изменения состояния приложения.  
Конструктор класса принимает инстант брокера событий.  
В полях класса хранятся следующие данные:
- `catalog: IProduct[]` массив товаров полученных с сервера
- `preview: IProduct | null` товар необходимый для показа в превью
- `basket: IProduct[]` массив товаров которые добавляют в корзину
- `order: IOrder объект` со всеми данными необходимыми для отправки на сервер
- `formOrderErrors: TFormOrderErrors` объект ошибок для формы оплаты и адреса
- `formContactsErrors: TFormContactsErrors` объект ошибок для формы персональных данных

Также класс предоставляет набор методов для работы с данными  
- `setCatalog(items: IProduct[])` Получает массив товаров, добавляет в поле каталога и создаёт событие о том что данные были сохранены
- `setPreview(item: IProduct)` Устанавливает выбранный объект в превью и создаёт событие для открытия превью
- `isActive(product: IProduct)` boolean Проверяет существует ли выбранный товар в корзине и возвращает либо `true` либо `false`
- `toggleOrderedProduct(product: IProduct)` Проверяет был ли добавлен товар в корзину, если нет то добавляет, если да то удаляет. Также вызывает событие изменения состояния.
- `deleteProduct(item: IProduct)` Удаляет товар из корзины и вызывает событие об изменении состояния корзины
- `setOrderField(field: keyof IOrderForm, value: string | TPayment)` записывает полученные данные оплаты и адреса в свойства объекта заказа. Вызывает функцию проверки состояний ввода, в случае положительного ответа вызывает событие о том что данные готовы и передаёт их в эмиттер
- `validateOrder()` проверяет правильность введенных данных оплаты и адреса и вызывает событие об изменение состояния формы. В случае отсутствия данных записывает ошибку
- `setContactsField(field: keyof IContactsForm, value: string)` записывает полученные данные пользователя в свойства объекта заказа. Вызывает функцию проверки состояний ввода, в случае положительного ответа вызывает событие о том что данные готовы и передаёт их в эмиттер
- `validateContacts()` проверяет правильность введенных персональных данных и вызывает событие об изменение состояния формы. В случае отсутствия данных записывает ошибку
- `getTotalPrice()` считает общую сумму товаров в корзине
- `clearBasket()` очищает данные заказа и корзины

### Классы представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных

#### Абстрактный класс Component

Базовый компонент  
Конструктор `constructor(protected readonly container: HTMLElement)` принимает родительски элемент.
класс предоставляет данный набор методов  
- `toggleClass(element: HTMLElement, className: string, force?: boolean)` Переключает класс выбранного элемента
- `setText(element: HTMLElement, value: unknown)` Устанавливает текстовое содержимое
- `setDisabled(element: HTMLElement, state: boolean)` меняет статус блокировки
- `setHidden(element: HTMLElement)` скрывает элемент
- `setVisible(element: HTMLElement)` показывает элемент
- `setImage(element: HTMLImageElement, src: string, alt?: string)` устанавливает изображение с алтернативным текстом
-  `render(data?: Partial<T>): HTMLElement` возвращает корневой DOM-элемент

#### Класс Modal

Дочерний класс `Component`. Реализует модальное окно. Предоставляет методы `open` `close` для открытия и закрытия модального окна и вызывает одноименные слушатели. Также пердосталвяет метод `render` для отрисовки модального окна. Устанавливает слушатель закрытия модалки по нажатию на кнопку закрытия и клику вне окна.  
Конструктор `constructor(container: HTMLElement, protected events: IEvents)` принимает родительский элемент и экземпляр класса `EventEmitter` для возможности инициации событий  

Поля класса  
-  `_closeButton: HTMLButtonElement` Кнопка закрытия модального окна
- `_content: HTMLElement` Дочерний элемент модального окна

#### Класс Basket

Дочерний класс `Component`. Реализует элемент корзины. По кнопке оформления заказа вызывает событие открытия заказа.
Конструктор `constructor(container: HTMLElement, protected events: EventEmitter)` принимает родительский элемент и экземпляр класса `EventEmitter` для возможности инициации событий 

Поля класса  
- `_list: HTMLElement` элемент списка
- `_totalPrice: HTMLElement` элемент где показывается общая цена корзины
- `_button: HTMLElement` кнопка оформления заказа  

Методы  
- `setTotalPrice(total: number)` устанавливает в текстовом элементе сумму заказа
- `set items(items: HTMLElement[])` устанавливает элементы друг за другом в элемент списка и включает кнопку оформления заказа. Если элементов нет, то показывает что корзина пуста и блокирует кнопку  

#### Класс Form

Дочерний класс `Component`. Базовый класс для формы. Конструктор `constructor(protected container: HTMLFormElement, protected events: IEvents)` принимает родительский элемент и экземпляр класса `EventEmitter` для возможности инициации событий. Устанавливает слушатель на ввод текста и проверяет с помощью методов валидность и ошибки.

Поля класса
- `_submit: HTMLButtonElement` элемент кнопки подтверждения
- `_errors: HTMLElement` элемент с ошибкой

Методы  
- `onInputChange(field: keyof T, value: string)` вызывает событие и передает объект с полем и значением поля
- `set valid(value: boolean)`  включает или выключает кнопку
- `set errors(value: string)` устанавливает текст ошибки
- `render(state: Partial<T> & IFormState)` рендерит форму

#### Класс Success

Дочерний класс `Component`. Показывает успешность отправки заказа на сервер. Также показывает сумму потребовавшуюся для заказа. Конструктор `constructor(container: HTMLElement, actions: ISuccessActions)` принимает родительский элемент и действие совершаемое в этом классе.

Поля класса  
- `_close: HTMLElement` элемент кнопки закрытия
- `_totalPrice: HTMLElement` элемент с общей суммой заказа

Методы
- `setTotalPrice(total: number)` устанавливает в текстовом элементе сумму заказа

#### Базовый класс BasicCard

Дочерний класс `Component`. Базовый класс Карточки товара. Нужен для самой основной информации. Конструктор `constructor(protected blockName: string, container: HTMLElement, actions?: ICardActions)` принимает название базового класса карточки, родительский элемент а также действия совершаемое над карточкой. Если в классе присутствует кнопка то вешает на неё слушатель по клику и передает событие.

Поля класса
- `_title: HTMLElement` Элемент с названием карточки
- `_price: HTMLElement` элемент с ценой карточки
- `_button?: HTMLButtonElement` элемент кнопки карточки

Методы
- `set title(value: string)` устанавливает в текстовом элементе название
- `set price(value: number | null)` устанавливает в элементе цену(если она есть) либо показвает что у товара нет цены  

#### Класс CatalogCard

Дочерний класс `BasicCard`. Класс для отображения карточки в каталоге. Конструктор `constructor (container: HTMLElement, actions?: ICardActions)` принимает родительский элемент а также действия совершаемое над карточкой.

Поля класса
- `_image: HTMLImageElement` элемент изображения
- `_category: HTMLElement` элемент категории товара
- `categoryClasses: { [key in TCategory]: string }` объект с категориями и их классами

Методы
- `set image(value: string)` устанавливает изображение
- `set category(value: TCategory)` убирает лишние классы и устанавливает необходимый класс для отображения

#### Класс FullCard

Дочерний класс `catalogCard`. Класс для отображения карточки в превью.

Поля
- `_description: HTMLElement` элемент с описанием товара

Методы
- `set description(value: string)` устанавливает в элементе описание
- `set buttonStatus(value: boolean)` проверяет состояние кнопки и от этой зависимости устанаваливает в ней текст  
- `set price(value: number | null)` устанавливает в элементе цену(если она есть) либо показвает что у товара нет цены и блокирует кнопку покупки  

#### Класс BasketCard  

Дочерний класс `BasicCard`. Класс для отображения в корзине. Имеет индекс в зависимости от положения товара в корзине.

Поля
- `_index: HTMLElement` элемент для отображения индекса товара

Методы
- `set index(value: number)` устанавливает индекс по переданному значению

#### Класс Contacts

Дочерний класс `Form`. Необходим для отображения инпутов для записи имейла и номера телефона.

Методы
- `set email(value: string)` устанавливает свойство формы равным переданному значению.
- `set phone(value: string)` устанавливает свойство формы равным переданному значению.

#### Класс Order

Дочерний класс `Form`. Необходим для отображения кнопок выбора метода оплаты и инпута адреса. Добавляает слушатели на кнопки и меняет их классы а также вызывает слушатель который передает объект со значением кнопки.

Поля
- `_card: HTMLButtonElement элемент` с кнопкой выбора оплаты по карте
- `_cash: HTMLButtonElement элемент` с кнопкой выбора оплаты наличными

Методы
- `set address(value: string)` устанавливает свойство формы равным переданному значению.


#### Класс Page

Дочерний класс `Component`. Необходим для размещения в нём элементов разметки. Устанавливает на элемент корзины слушатель который открывает модальное окно с корзиной  

Поля
- `_catalog: HTMLElement` элемент каталога
- `_wrapper: HTMLElement` контейнер элемента
- `_counter: HTMLElement` элемент счётчика
- `_basket: HTMLElement` элемент корзины

Методы
- `set counter(value: number)` устанавливает переданное значение количества товараов в корзине в элемент счётчика
- `set catalog(items: HTMLElement[])` устнавливает переданные элементы карточек друг за другом в разметке
- `set locked(value: boolean)` блокирует или нет контент

### Слой коммуникации

#### Класс AppAPI

Принимает в конструктор экземпляр класса `Арі` и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле
`index.ts`, выполняющем роль презентера.  
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`  
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается
обработка событий.

Список всех событий, которые могут генерироваться в системе:  

События изменения данных (генерируются классами моделями данных)  
- `catalog:downloaded` изменение данныз в массиве каталога
- `fullCard:open` изменение прьевью 
- `basket:open` изменение данных корзины

События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)
- `modal:open` открытие модального окна
- `modal:close` закрытие модального окна
- `card:select` выбор карточки
- `fullCard:open` открытие превью карточки
- `item:addOrDelete` Добавление/удаление карточки из превью
- `item:remove` удаление карточки из корзины
- `order:open` открытие окна с оплатой и адресом
- `order:submit` открытие окна с имейлом и телефоном
- `order:ready` успешная запись в инпуте адреса
- `formOrderErrors:change` изменение состояния валидации формы
- `contacts:ready` успешная запись в инпутах контактов
- `formContactsErrors:change` изменение состояния валидации формы